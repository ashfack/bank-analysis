
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bank Analysis - Results</title>
  
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='results.css') }}">
      
</head>
<body>
  <div class="container">
    <h1>Analysis Results</h1>

    <h2>Monthly Summary</h2>
    <table id="summary-table">
      <thead>
        <tr>
          <th>Period</th>
          <th>Total Salary</th>
          <th>Total Expenses</th>
          <th># Expense Ops</th>
          <th>Total Savings</th>
          <th>Savings vs Theoretical</th>
        </tr>
      </thead>
      <tbody>
        {% for row in customAnalysis %}
          <tr class="summary-row" data-period="{{ row.month }}">
            <td>{{ row.month }}</td>
            <td>{{ "%.2f"|format(row.total_salary) }}</td>
            <td>{{ "%.2f"|format(row.total_expenses) }}</td>
            <td>{{ row.nb_expense_operations }}</td>
            <td>{{ "%.2f"|format(row.total_savings) }}</td>
            <td>{{ "%.2f"|format(row.total_savings_vs_theoretical) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div id="details-container">
      <p><em>Click a row above to see expense breakdown by category.</em></p>
    </div>

    <p>
      <a href="{{ url_for('index') }}" class="back">Back</a>
    <script>
    document.querySelectorAll('.summary-row').forEach(row => {
      row.addEventListener('click', () => {
        const period = row.dataset.period;
        fetch(`/details?period=${encodeURIComponent(period)}`)
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('details-container');
            if (!data || data.length === 0) {
              container.innerHTML = "<p>No details available for this period.</p>";
              return;
            }
            let html = `<h3>Expense Breakdown for ${period}</h3>`;
            html += "<table><thead><tr><th>Category</th><th>Total</th><th># Ops</th></tr></thead><tbody>";
            data.forEach(item => {
              html += `<tr><td>${item.category_parent}</td><td>${item.total.toFixed(2)}</td><td>${item.nb_operations}</td></tr>`;
            });
            html += "</tbody></table>";
            container.innerHTML = html;
          });
      });
    });
  </script>
</body>
</html>